<app-header></app-header>

<div class="container mt-4">
  <h2>1º Passo: Escolher Actos Clínicos</h2>

  <!-- Formulário de Registro -->
  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="mb-4">
    <div class="row g-3">
      
      <!-- Horário -->
      <div class="col-md-6">
        <label for="horarioSolicitado" class="form-label">Horário</label>
        <p-calendar
          formControlName="horarioSolicitado"
          [timeOnly]="true"
          hourFormat="24"
          inputId="horarioSolicitado"
          class="form-control"
          placeholder="Selecione o horário"
        ></p-calendar>
        <div *ngIf="isSubmitted && registerForm.get('horarioSolicitado')?.invalid" class="text-danger mt-1">
          Horário é obrigatório
        </div>
      </div>

      <!-- Intervalo de solicitação -->
      <div class="col-md-6">
        <label for="dataRange" class="form-label">Intervalo de solicitação</label>
        <p-calendar
          formControlName="dataRange"
          selectionMode="range"
          inputId="dataRange"
          class="form-control"
          placeholder="Selecione o intervalo de datas"
        ></p-calendar>
        <div *ngIf="isSubmitted && registerForm.get('dataRange')?.invalid" class="text-danger mt-1">
          Intervalo de datas é obrigatório
        </div>
      </div>

      <!-- Subsistema de saúde -->
      <div class="col-md-6">
        <label for="subsistema" class="form-label">Subsistema de saúde</label>
        <p-dropdown
          formControlName="subsistema"
          inputId="subsistema"
          [options]="subsistemas"
          optionLabel="name"
          placeholder="Selecione o subsistema de saúde"
          class="form-control"
        ></p-dropdown>
        <div *ngIf="isSubmitted && registerForm.get('subsistema')?.invalid" class="text-danger mt-1">
          Subsistema de saúde é obrigatório
        </div>
      </div>

      <!-- Tipo de consulta -->
      <div class="col-md-6">
        <label for="tipodeconsulta" class="form-label">Tipo de consulta</label>
        <p-dropdown
          formControlName="tipodeconsulta"
          inputId="tipodeconsulta"
          [options]="tiposConsulta"
          optionLabel="name"
          placeholder="Selecione o tipo de consulta"
          class="form-control"
        ></p-dropdown>
        <div *ngIf="isSubmitted && registerForm.get('tipodeconsulta')?.invalid" class="text-danger mt-1">
          Tipo de consulta é obrigatório
        </div>
      </div>

      <!-- Profissional -->
      <div class="col-md-6">
        <label for="profissional" class="form-label">Profissional</label>
        <p-dropdown
          formControlName="profissional"
          inputId="profissional"
          [options]="profissionais"
          optionLabel="name"
          placeholder="Selecione o profissional"
          class="form-control"
        ></p-dropdown>
      </div>

      <!-- Observações adicionais -->
      <div class="col-md-6">
        <label for="observacoesAdicionais" class="form-label">Observações adicionais</label>
        <input
          formControlName="observacoesAdicionais"
          pInputText
          type="text"
          id="observacoesAdicionais"
          class="form-control"
          placeholder="Digite as observações adicionais caso tiver"
          maxlength="100"
        />
        <div *ngIf="isSubmitted && registerForm.get('observacoesAdicionais')?.errors?.['maxlength']" class="text-danger mt-1">
          Observações não podem exceder 100 caracteres
        </div>
      </div>
    </div>

    <!-- Botão de Submissão -->
    <div class="mt-3">
      <button pButton type="submit" label="Adicionar Acto" class="btn btn-success"></button>
    </div>
  </form>

  <!-- Tabela de Actos Clínicos -->
  <h3>Serviços</h3>
  <p-table
    [value]="formattedActosClinicos"
    [globalFilterFields]="['subsistemaSaude', 'tipoConsulta', 'profissional', 'horario', 'observacoesAdicionais']"
    [rows]="5"
    [paginator]="true"
  >
    <!-- Barra de pesquisa -->
    <ng-template pTemplate="caption">
      <div class="input-group mb-3">
        <span class="input-group-text"><i class="pi pi-search"></i></span>
        <input
          pInputText
          type="text"
          class="form-control"
          (input)="onGlobalFilter($event)"
          placeholder="Pesquisar Actos Clínicos"
        />
      </div>
    </ng-template>

    <!-- Cabeçalho da tabela -->
    <ng-template pTemplate="header">
      <tr>
        <th>Subsistema de Saúde</th>
        <th>Tipo de Consulta</th>
        <th>Profissional</th>
        <th>Horário</th>
        <th>Observações</th>
      </tr>
    </ng-template>

    <!-- Corpo da tabela -->
    <ng-template pTemplate="body" let-acto>
      <tr>
        <td>{{ acto.subsistemaSaude || 'Sem Subsistema' }}</td>
        <td>{{ acto.tipoConsulta || 'Sem Tipo' }}</td>
        <td>{{ acto.profissional || 'Sem Profissional' }}</td>
        <td>{{ acto.horario || 'Sem Horário' }}</td>
        <td>{{ acto.observacoesAdicionais || 'Sem Observações' }}</td>
      </tr>
    </ng-template>

    <!-- Mensagem de vazio -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">Nenhum ato clínico encontrado.</td>
      </tr>
    </ng-template>
  </p-table>
  <!-- Botão de Submissão -->
    <div class="mt-3">
      <button pButton type="submit" label="Solicitar Marcação" class="btn btn-success"></button>
    </div>
</div>


<app-footer></app-footer>
