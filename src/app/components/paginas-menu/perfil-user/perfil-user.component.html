<app-header></app-header>

<div class="profile-container">
  <!-- Profile Summary Card -->
  <div class="profile-card">
    <div class="profile-header">
      <div class="profile-name">{{ user?.nome || 'Seu Nome' }}</div>
    </div>
    <div class="profile-pic-container">
      <img *ngIf="user?.fotografia" [src]="'https://localhost:7273' + user?.fotografia" alt="Foto de Perfil" class="profile-pic" />
      <i *ngIf="!user?.fotografia" class="pi pi-user profile-icon"></i>
    </div>
    <div class="profile-content">
      <div class="d-flex justify-content-center gap-4 mb-4">
        <div class="text-center">
          <div class="fs-5 fw-bold">{{ marcacoes?.length || '0' }}</div>
          <div class="text-muted">Marcaçōes</div>
        </div>
        <div class="text-center">
          <div class="fs-5 fw-bold">{{ getMarcacoesByEstado('Confirmada') }}</div>
          <div class="text-muted">Confirmadas</div>
        </div>
        <div class="text-center">
          <div class="fs-5 fw-bold">{{ getMarcacoesByEstado('Pendente') }}</div>
          <div class="text-muted">Pendentes</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="tab-container">
    <p-tabView>
      <!-- Tab 1: My Data -->
      <p-tabPanel header="Meus Dados">
        <div class="user-details">
          <div *ngIf="isEditing; else viewMode">
            <form (ngSubmit)="onSubmit()" #userForm="ngForm" class="form-container">
              <div class="row">
                <div class="col-md-6">
                  <div class="field">
                    <label for="nome">Nome</label>
                    <input pInputText id="nome" [(ngModel)]="editUser.nome" name="nome" required class="form-control" placeholder="Seu nome completo">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="field">
                    <label for="email">Email</label>
                    <input pInputText id="email" [(ngModel)]="editUser.email" name="email" required class="form-control" placeholder="seu.email@exemplo.com">
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="field">
                    <label for="telemovel">Telemóvel</label>
                    <input pInputText id="telemovel" [(ngModel)]="editUser.telemovel" name="telemovel" required class="form-control" placeholder="(00) 00000-0000">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="field">
                    <label for="genero">Gênero</label>
                    <p-dropdown [options]="genders" [(ngModel)]="editUser.genero" name="genero" placeholder="Selecione seu gênero" styleClass="w-full"></p-dropdown>
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <div class="field">
                    <label for="dataNascimento">Data de Nascimento</label>
                    <p-calendar id="dataNascimento" [(ngModel)]="editUser.dataNascimento" name="dataNascimento" dateFormat="dd/mm/yy" [showIcon]="true" required></p-calendar>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="field">
                    <label for="morada">Morada</label>
                    <input pInputText id="morada" [(ngModel)]="editUser.morada" name="morada" required class="form-control" placeholder="Sua morada completa">
                  </div>
                </div>
              </div>
              
              <div class="button-group">
                <button pButton pRipple type="button" label="Cancelar" (click)="toggleEdit()" class="p-button-outlined p-button-secondary"></button>
                <button pButton pRipple type="submit" label="Salvar Alterações" class="p-button-primary"></button>
              </div>
            </form>
          </div>
          
          <ng-template #viewMode>
            <div>
              <p>
                <strong>Nome:</strong> 
                <span>{{ user?.nome }}</span>
              </p>
              <p>
                <strong>Email:</strong> 
                <span>{{ user?.email }}</span>
              </p>
              <p>
                <strong>Telemóvel:</strong> 
                <span>{{ user?.telemovel }}</span>
              </p>
              <p>
                <strong>Morada:</strong> 
                <span>{{ user?.morada }}</span>
              </p>
              <p>
                <strong>Data de Nascimento:</strong> 
                <span>{{ user?.dataNascimento | date:'dd/MM/yyyy' }}</span>
              </p>
              <p>
                <strong>Gênero:</strong> 
                <span>{{ user?.genero }}</span>
              </p>
              
              <div class="button-group">
                <button pButton pRipple label="Editar Perfil" (click)="toggleEdit()" class="p-button-primary"></button>
              </div>
            </div>
          </ng-template>
        </div>
      </p-tabPanel>

      <!-- Tab 2: My Appointments -->
      <p-tabPanel header="Minhas Marcações">
        <div class="appointments-card">
          <div class="appointment-header">
            <h3>Minhas Marcações</h3>
            <button pButton pRipple label="Nova Marcação" class="p-button-outlined p-button-help" (click)="newAppointment()"></button>
          </div>
          
          <!-- Appointment Cards -->
          <div *ngFor="let marcacao of marcacoes" class="appointment-card">
            <div class="appointment-card-header" (click)="toggleAppointmentDetails(marcacao)">
              <div>
                <h4 class="mb-1">{{ marcacao.nome }}</h4>
                <div class="d-flex align-items-center gap-3">
                  <div><i class="pi pi-calendar"></i> {{ marcacao.data | date:'dd MMM yyyy' }}</div>
                  <div><i class="pi pi-clock"></i> {{ marcacao.hora }}</div>
                </div>
              </div>
              <div>
                <span class="status-badge" [ngClass]="{
                  'status-confirmed': marcacao.estado === 'Confirmada',
                  'status-pending': marcacao.estado === 'Pendente',
                  'status-canceled': marcacao.estado === 'Cancelada'
                }">
                  {{ marcacao.estado }}
                </span>
              </div>
            </div>
            
            <div class="appointment-card-body" *ngIf="isAppointmentExpanded(marcacao)">
              <h5>Detalhes:</h5>
              <p><strong>Médico:</strong> {{ marcacao.medico }}</p>
              <p><strong>Local:</strong> {{ marcacao.local }}</p>
              
              <h5 class="mt-3">Actos Clínicos:</h5>
              <div *ngFor="let acto of marcacao.actosClinicos" class="acto-item">
                <i class="pi pi-check-circle"></i> {{ acto }}
              </div>
              
              <div class="d-flex gap-2 mt-4">
                <button pButton pRipple label="Cancelar" class="p-button-outlined p-button-danger" *ngIf="marcacao.estado !== 'Cancelada'"></button>
                <button pButton pRipple label="Reagendar" class="p-button-outlined p-button-primary" *ngIf="marcacao.estado !== 'Cancelada'"></button>
                <button pButton pRipple label="Detalhes" class="p-button-outlined p-button-secondary"></button>
              </div>
            </div>
          </div>
          
          <!-- Empty State -->
          <div *ngIf="!marcacoes || marcacoes.length === 0" class="text-center py-5">
            <i class="pi pi-calendar" style="font-size: 3rem; color: #ced4da;"></i>
            <h4 class="mt-3">Nenhuma marcação encontrada</h4>
            <p class="text-muted">Você ainda não possui marcações agendadas</p>
            <button pButton pRipple label="Agendar Consulta" class="p-button-primary mt-3"></button>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>

<app-footer></app-footer>